<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delivery Map Pro</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; min-height: 100vh; }
.topbar { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; padding: 18px; text-align: center; font-size: 22px; font-weight: 700; letter-spacing: 1px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
.topbar span { margin-right: 8px; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
.card { background: #fff; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
.card h3 { color: #1a1a2e; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 2px solid #eef2f7; }

/* Form Elements */
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-weight: 600; color: #444; margin-bottom: 6px; font-size: 14px; }
input, select, textarea { width: 100%; padding: 12px 15px; margin: 8px 0; border: 2px solid #e1e5eb; border-radius: 8px; font-size: 15px; transition: all 0.3s; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 3px rgba(79,70,229,0.1); }
textarea { resize: vertical; min-height: 80px; }

/* Buttons */
.btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
.btn-primary { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: #fff; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(79,70,229,0.4); }
.btn-secondary { background: #6b7280; color: #fff; }
.btn-secondary:hover { background: #4b5563; }
.btn-danger { background: #ef4444; color: #fff; }
.btn-danger:hover { background: #dc2626; }
.btn-success { background: #10b981; color: #fff; }
.btn-success:hover { background: #059669; }
.btn-outline { background: transparent; border: 2px solid #4f46e5; color: #4f46e5; }
.btn-outline:hover { background: #4f46e5; color: #fff; }
.btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
.btn-group .btn { flex: 1; min-width: 120px; justify-content: center; }

/* Status Badge */
.status-badge { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 700; text-transform: uppercase; }
.status-pending { background: #fef3c7; color: #d97706; }
.status-delivered { background: #d1fae5; color: #059669; }
.status-returned { background: #fee2e2; color: #dc2626; }

/* Map */
#map { height: 500px; border-radius: 12px; margin-top: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }

/* Messages */
.message { padding: 12px 16px; border-radius: 8px; margin: 10px 0; font-weight: 500; }
.success { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
.error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
.info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }

/* Auth Section */
.auth-wrapper { display: flex; justify-content: center; align-items: center; min-height: 80vh; }
.auth-card { max-width: 420px; width: 100%; }
.auth-card .logo { text-align: center; margin-bottom: 30px; }
.auth-card .logo h2 { color: #1a1a2e; font-size: 28px; }
.auth-card .logo p { color: #6b7280; margin-top: 5px; }

/* Details Panel */
.details-panel { background: #f8fafc; border-radius: 10px; padding: 20px; margin-top: 15px; display: none; }
.details-panel.show { display: block; animation: fadeIn 0.3s; }
.details-panel h4 { color: #1a1a2e; margin-bottom: 15px; }
.detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb; }
.detail-row:last-child { border-bottom: none; }
.detail-label { font-weight: 600; color: #6b7280; }
.detail-value { color: #1a1a2e; font-weight: 500; }

/* Location Controls */
.location-controls { display: flex; gap: 10px; margin: 10px 0; }
.location-status { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #6b7280; }
.dot { width: 10px; height: 10px; border-radius: 50%; background: #9ca3af; }
.dot.active { background: #10b981; animation: pulse 2s infinite; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

/* Utility */
.hidden { display: none !important; }
.flex { display: flex; gap: 10px; flex-wrap: wrap; }
.mt-10 { margin-top: 10px; }

/* Responsive */
@media (max-width: 768px) {
  .container { padding: 15px; }
  .card { padding: 18px; }
  #map { height: 350px; }
  .btn-group .btn { min-width: 100%; }
}
</style>
</head>
<body>

<!-- Top Bar -->
<div class="topbar">
  <span>üöö</span> Delivery Map Pro
</div>

<div class="container">

<!-- Auth Card -->
<div id="authCard" class="card auth-wrapper">
  <div class="auth-card">
    <div class="logo">
      <h2>üöö Delivery Map Pro</h2>
      <p>Manage your deliveries efficiently</p>
    </div>
    <div class="form-group">
      <label>Email Address</label>
      <input type="email" id="loginEmail" placeholder="Enter your email">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="Enter your password">
    </div>
    <div class="btn-group">
      <button id="loginBtn" class="btn btn-primary" style="flex:2">üîë Login</button>
      <button id="registerBtn" class="btn btn-outline" style="flex:1">Register</button>
    </div>
    <div id="authMsg"></div>
    <p style="text-align:center;margin-top:15px;color:#6b7280;font-size:13px;">
      For demo: Register new account or use existing credentials
    </p>
  </div>
</div>

<!-- Main App -->
<div id="app" class="hidden">

<!-- Header & Logout -->
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;">
    <div>
      <h3 style="margin:0;border:none;padding:0;">Welcome, <span id="userEmail" style="color:#4f46e5;"></span></h3>
    </div>
    <button id="logoutBtn" class="btn btn-danger">üö™ Logout</button>
  </div>
  
  <!-- Live Location Status -->
  <div class="location-controls mt-10">
    <div class="location-status">
      <span class="dot" id="locationDot"></span>
      <span id="locationStatusText">Location: Not available</span>
    </div>
    <button id="refreshLocationBtn" class="btn btn-secondary" style="padding:8px 15px;font-size:13px;">üîÑ Refresh</button>
  </div>
</div>

<!-- Add/Update Delivery Card -->
<div class="card">
  <h3>üì¶ Add / Update Delivery</h3>
  
  <div class="flex" style="gap:15px;">
    <div style="flex:1;min-width:250px;">
      <div class="form-group">
        <label>Mobile Number *</label>
        <input type="tel" id="mobileInput" placeholder="01XXXXXXXXX">
      </div>
    </div>
    <div style="flex:1;min-width:250px;">
      <div class="form-group">
        <label>Delivery Status</label>
        <select id="statusSelect">
          <option value="Pending">‚è≥ Pending</option>
          <option value="Delivered">‚úÖ Delivered</option>
          <option value="Returned">‚Ü©Ô∏è Returned</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="form-group">
    <label>Full Address *</label>
    <input type="text" id="addressInput" placeholder="Enter complete delivery address">
  </div>
  
  <div class="form-group">
    <label>Pickup Location</label>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <input type="text" id="pickupLat" placeholder="Latitude" style="flex:1;min-width:120px;" readonly>
      <input type="text" id="pickupLng" placeholder="Longitude" style="flex:1;min-width:120px;" readonly>
      <button id="getPickupLocationBtn" class="btn btn-secondary">üìç Get Current</button>
    </div>
  </div>
  
  <div class="form-group">
    <label>Delivery Notes</label>
    <textarea id="noteInput" placeholder="Any special instructions..."></textarea>
  </div>
  
  <div class="btn-group">
    <button id="saveBtn" class="btn btn-success">üíæ Save / Update</button>
    <button id="clearFormBtn" class="btn btn-secondary">‚ú® Clear Form</button>
    <button id="deleteBtn" class="btn btn-danger">üóëÔ∏è Delete</button>
  </div>
  <div id="saveMsg"></div>
</div>

<!-- Search Card -->
<div class="card">
  <h3>üîç Search Delivery</h3>
  <div style="display:flex;gap:10px;flex-wrap:wrap;">
    <input type="tel" id="searchInput" placeholder="Enter mobile number to search" style="flex:1;min-width:200px;">
    <button id="searchBtn" class="btn btn-primary">Search</button>
  </div>
  
  <!-- Search Results Details -->
  <div id="detailsPanel" class="details-panel">
    <h4>üìã Delivery Details</h4>
    <div class="detail-row">
      <span class="detail-label">Mobile:</span>
      <span class="detail-value" id="detailMobile">-</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Address:</span>
      <span class="detail-value" id="detailAddress">-</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Status:</span>
      <span class="detail-value" id="detailStatus">-</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Note:</span>
      <span class="detail-value" id="detailNote">-</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Location:</span>
      <span class="detail-value" id="detailLocation">-</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Last Updated:</span>
      <span class="detail-value" id="detailUpdated">-</span>
    </div>
  </div>
</div>

<!-- Map Card -->
<div class="card">
  <h3>üó∫Ô∏è Live Map</h3>
  <div id="map"></div>
</div>

</div>

</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, deleteDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// ==================== CONFIGURATION ====================
const firebaseConfig = {
  apiKey: "AIzaSyA82YWF574aCnkYdwN0airAcFl-_M21sHM",
  authDomain: "delivery-map-pro.firebaseapp.com",
  projectId: "delivery-map-pro",
  storageBucket: "delivery-map-pro.firebasestorage.app",
  messagingSenderId: "544868009171",
  appId: "1:544868009171:web:005b3e95248eac940b8026"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ==================== DOM ELEMENTS ====================
const authCard = document.getElementById("authCard");
const appDiv = document.getElementById("app");
const loginEmail = document.getElementById("loginEmail");
const loginPassword = document.getElementById("loginPassword");
const authMsg = document.getElementById("authMsg");
const userEmail = document.getElementById("userEmail");
const locationDot = document.getElementById("locationDot");
const locationStatusText = document.getElementById("locationStatusText");

// Form elements
const mobileInput = document.getElementById("mobileInput");
const addressInput = document.getElementById("addressInput");
const statusSelect = document.getElementById("statusSelect");
const noteInput = document.getElementById("noteInput");
const pickupLat = document.getElementById("pickupLat");
const pickupLng = document.getElementById("pickupLng");
const saveMsg = document.getElementById("saveMsg");

// Search elements
const searchInput = document.getElementById("searchInput");
const detailsPanel = document.getElementById("detailsPanel");

// Map variables
let map;
let userMarker = null;
let deliveryMarkers = [];
let watchId = null;
let currentPosition = null;

// ==================== MAP INITIALIZATION ====================
function initMap() {
  if (map) {
    map.remove();
    map = null;
  }
  
  // Default view (Dhaka, Bangladesh)
  map = L.map('map').setView([23.8103, 90.4125], 12);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors'
  }).addTo(map);
  
  // Request location permission and track
  requestLocationPermission();
}

// ==================== LOCATION SERVICES ====================
function requestLocationPermission() {
  if (!navigator.geolocation) {
    updateLocationStatus(false, "Geolocation not supported");
    return;
  }
  
  updateLocationStatus(false, "Requesting permission...");
  
  navigator.geolocation.getCurrentPosition(
    (position) => {
      currentPosition = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      updateUserMarker(currentPosition);
      updateLocationStatus(true, "Live location active");
    },
    (error) => {
      let msg = "Location unavailable";
      if (error.code === 1) msg = "Permission denied";
      else if (error.code === 2) msg = "Position unavailable";
      else if (error.code === 3) msg = "Timeout";
      updateLocationStatus(false, msg);
    },
    {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    }
  );
}

function startLocationWatch() {
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
  }
  
  watchId = navigator.geolocation.watchPosition(
    (position) => {
      currentPosition = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };
      updateUserMarker(currentPosition);
      updateLocationStatus(true, "Live tracking active");
    },
    (error) => {
      console.error("Location watch error:", error);
    },
    {
      enableHighAccuracy: true,
      timeout: 5000,
      maximumAge: 0
    }
  );
}

function updateUserMarker(pos) {
  if (!map) return;
  
  if (userMarker) {
    userMarker.setLatLng([pos.lat, pos.lng]);
  } else {
    const userIcon = L.divIcon({
      html: '<div style="background:#4f46e5;width:20px;height:20px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,0.3);"></div>',
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });
    
    userMarker = L.marker([pos.lat, pos.lng], { icon: userIcon })
      .addTo(map)
      .bindPopup("<b>üìç Your Location</b><br>Current Position")
      .openPopup();
  }
  
  map.setView([pos.lat, pos.lng], 14);
}

function updateLocationStatus(active, text) {
  locationDot.classList.toggle('active', active);
  locationStatusText.textContent = text;
}

// ==================== AUTHENTICATION ====================
onAuthStateChanged(auth, (user) => {
  if (user) {
    authCard.classList.add("hidden");
    appDiv.classList.remove("hidden");
    userEmail.textContent = user.email;
    
    // Initialize map after short delay
    setTimeout(() => {
      initMap();
      startLocationWatch();
    }, 300);
  } else {
    authCard.classList.remove("hidden");
    appDiv.classList.add("hidden");
    userEmail.textContent = "";
    
    if (map) {
      map.remove();
      map = null;
    }
    if (watchId) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
    }
  }
});

// Login
document.getElementById("loginBtn").onclick = async () => {
  const email = loginEmail.value.trim();
  const password = loginPassword.value;
  
  if (!email || !password) {
    authMsg.innerHTML = '<div class="message error">Please enter email and password</div>';
    return;
  }
  
  authMsg.innerHTML = '<div class="message info">Logging in...</div>';
  
  try {
    await signInWithEmailAndPassword(auth, email, password);
    authMsg.innerHTML = '<div class="message success">‚úì Login Successful!</div>';
    loginEmail.value = '';
    loginPassword.value = '';
  } catch (error) {
    console.error("Login error:", error);
    let msg = error.message;
    if (error.code === 'auth/invalid-email') msg = 'Invalid email address';
    else if (error.code === 'auth/user-not-found') msg = 'No account with this email';
    else if (error.code === 'auth/wrong-password') msg = 'Incorrect password';
    else if (error.code === 'auth/invalid-credential') msg = 'Invalid email or password';
    authMsg.innerHTML = `<div class="message error">${msg}</div>`;
  }
};

// Register
document.getElementById("registerBtn").onclick = async () => {
  const email = loginEmail.value.trim();
  const password = loginPassword.value;
  
  if (!email || !password) {
    authMsg.innerHTML = '<div class="message error">Please enter email and password</div>';
    return;
  }
  
  if (password.length < 6) {
    authMsg.innerHTML = '<div class="message error">Password must be at least 6 characters</div>';
    return;
  }
  
  authMsg.innerHTML = '<div class="message info">Creating account...</div>';
  
  try {
    await createUserWithEmailAndPassword(auth, email, password);
    authMsg.innerHTML = '<div class="message success">‚úì Account created! You are now logged in.</div>';
    loginEmail.value = '';
    loginPassword.value = '';
  } catch (error) {
    console.error("Register error:", error);
    let msg = error.message;
    if (error.code === 'auth/email-already-in-use') msg = 'An account with this email already exists';
    else if (error.code === 'auth/invalid-email') msg = 'Invalid email address';
    else if (error.code === 'auth/weak-password') msg = 'Password is too weak';
    authMsg.innerHTML = `<div class="message error">${msg}</div>`;
  }
};

// Logout
document.getElementById("logoutBtn").onclick = async () => {
  try {
    await signOut(auth);
  } catch (error) {
    console.error("Logout error:", error);
  }
};

// Refresh Location
document.getElementById("refreshLocationBtn").onclick = () => {
  requestLocationPermission();
};

// Get Pickup Location
document.getElementById("getPickupLocationBtn").onclick = () => {
  if (currentPosition) {
    pickupLat.value = currentPosition.lat.toFixed(6);
    pickupLng.value = currentPosition.lng.toFixed(6);
    saveMsg.innerHTML = '<div class="message success">Pickup location captured!</div>';
  } else {
    saveMsg.innerHTML = '<div class="message error">Location not available. Please wait or refresh.</div>';
  }
};

// ==================== SAVE / UPDATE DELIVERY ====================
document.getElementById("saveBtn").onclick = async () => {
  const mobile = mobileInput.value.trim();
  const address = addressInput.value.trim();
  const status = statusSelect.value;
  const note = noteInput.value.trim();
  const lat = pickupLat.value ? parseFloat(pickupLat.value) : null;
  const lng = pickupLng.value ? parseFloat(pickupLng.value) : null;
  
  // Validation
  if (!mobile) {
    saveMsg.innerHTML = '<div class="message error">Mobile number is required!</div>';
    mobileInput.focus();
    return;
  }
  
  if (!address) {
    saveMsg.innerHTML = '<div class="message error">Address is required!</div>';
    addressInput.focus();
    return;
  }
  
  if (!/^\d{8,15}$/.test(mobile.replace(/\D/g, ''))) {
    saveMsg.innerHTML = '<div class="message error">Please enter a valid mobile number</div>';
    return;
  }
  
  saveMsg.innerHTML = '<div class="message info">Saving...</div>';
  
  try {
    const deliveryData = {
      address: address,
      status: status,
      note: note,
      lat: lat,
      lng: lng,
      uid: auth.currentUser.uid,
      updatedAt: Date.now()
    };
    
    await setDoc(doc(db, "deliveries", mobile), deliveryData);
    
    saveMsg.innerHTML = '<div class="message success">‚úì Saved Successfully! Delivery: ' + mobile + '</div>';
    
    // Add marker to map
    if (lat && lng) {
      addDeliveryMarker(lat, lng, address, status, mobile);
    }
    
    // Clear form after successful save
    setTimeout(() => {
      clearForm();
    }, 2000);
    
  } catch (error) {
    console.error("Save error:", error);
    saveMsg.innerHTML = '<div class="message error">Error: ' + error.message + '</div>';
  }
};

// Clear Form
document.getElementById("clearFormBtn").onclick = clearForm;

function clearForm() {
  mobileInput.value = '';
  addressInput.value = '';
  statusSelect.value = 'Pending';
  noteInput.value = '';
  pickupLat.value = '';
  pickupLng.value = '';
  saveMsg.innerHTML = '';
}

// ==================== DELETE DELIVERY ====================
document.getElementById("deleteBtn").onclick = async () => {
  const mobile = mobileInput.value.trim();
  
  if (!mobile) {
    saveMsg.innerHTML = '<div class="message error">Enter mobile number to delete</div>';
    return;
  }
  
  if (!confirm('Are you sure you want to delete delivery: ' + mobile + '?')) {
    return;
  }
  
  try {
    await deleteDoc(doc(db, "deliveries", mobile));
    saveMsg.innerHTML = '<div class="message success">‚úì Deleted successfully!</div>';
    clearForm();
    detailsPanel.classList.remove('show');
  } catch (error) {
    console.error("Delete error:", error);
    saveMsg.innerHTML = '<div class="message error">Error: ' + error.message + '</div>';
  }
};

// ==================== SEARCH DELIVERY ====================
document.getElementById("searchBtn").onclick = async () => {
  const searchMobile = searchInput.value.trim();
  
  if (!searchMobile) {
    alert('Please enter a mobile number to search');
    return;
  }
  
  try {
    const snap = await getDoc(doc(db, "deliveries", searchMobile));
    
    if (!snap.exists()) {
      alert('No delivery found with this number: ' + searchMobile);
      detailsPanel.classList.remove('show');
      return;
    }
    
    const d = snap.data();
    
    // Fill form
    mobileInput.value = searchMobile;
    addressInput.value = d.address || '';
    statusSelect.value = d.status || 'Pending';
    noteInput.value = d.note || '';
    pickupLat.value = d.lat || '';
    pickupLng.value = d.lng || '';
    
    // Show details panel
    document.getElementById('detailMobile').textContent = searchMobile;
    document.getElementById('detailAddress').textContent = d.address || '-';
    
    const statusClass = 'status-' + (d.status || 'pending').toLowerCase();
    document.getElementById('detailStatus').innerHTML = 
      `<span class="status-badge ${statusClass}">${d.status || 'Pending'}</span>`;
    
    document.getElementById('detailNote').textContent = d.note || '-';
    document.getElementById('detailLocation').textContent = 
      d.lat && d.lng ? `${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}` : 'Not set';
    document.getElementById('detailUpdated').textContent = 
      d.updatedAt ? new Date(d.updatedAt).toLocaleString() : '-';
    
    detailsPanel.classList.add('show');
    
    // Show on map
    if (d.lat && d.lng) {
      showOnMap(d.lat, d.lng, d.address, d.status);
    }
    
  } catch (error) {
    console.error("Search error:", error);
    alert('Error searching: ' + error.message);
  }
};

// Show delivery on map
function showOnMap(lat, lng, address, status) {
  if (!map) return;
  
  // Clear existing delivery markers
  deliveryMarkers.forEach(m => map.removeLayer(m));
  deliveryMarkers = [];
  
  let color = '#6b7280';
  if (status === 'Delivered') color = '#10b981';
  else if (status === 'Returned') color = '#ef4444';
  else color = '#f59e0b';
  
  const deliveryIcon = L.divIcon({
    html: `<div style="background:${color};width:24px;height:24px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;">üì¶</div>`,
    iconSize: [24, 24],
    iconAnchor: [12, 12]
  });
  
  const marker = L.marker([lat, lng], { icon: deliveryIcon })
    .addTo(map)
    .bindPopup(`<b>${status}</b><br>${address}`)
    .openPopup();
  
  deliveryMarkers.push(marker);
  map.setView([lat, lng], 16);
}

// Add delivery marker
function addDeliveryMarker(lat, lng, address, status, mobile) {
  if (!map) return;
  
  showOnMap(lat, lng, address, status);
}

// Allow Enter key to search
searchInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('searchBtn').click();
  }
});

// Allow Enter key to login
loginPassword.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('loginBtn').click();
  }
});

</script>
</body>
</html>
